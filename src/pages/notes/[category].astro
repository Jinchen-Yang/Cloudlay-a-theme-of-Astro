---
import BaseLayout from '../../layouts/BaseLayout.astro';
import ItemLink from '../../components/ItemLink.astro';
import Breadcrumb from '../../components/Breadcrumb.astro';
import { getNoteCategories, getSortedNotes } from '../../utils/content';

export async function getStaticPaths() {
  const categories = await getNoteCategories();

  return categories.map(category => ({
    params: { category }
  }));
}

const { category } = Astro.params;

// è·å–å½“å‰åˆ†ç±»ä¸‹çš„æ‰€æœ‰ç¬”è®°
const postsInCategory = await getSortedNotes(category!);

// æ ¼å¼åŒ–æ•°æ®ä¾›æ¨¡æ¿ä½¿ç”¨
const files = postsInCategory.map(note => {
  const parts = note.slug.split('/');
  const fileName = parts[parts.length - 1]; // è·å–æ–‡ä»¶å
  return {
    name: note.data.title || fileName, // ä¼˜å…ˆæ˜¾ç¤ºæ ‡é¢˜
    path: `/${fileName}`, // é“¾æ¥åªéœ€ååŠéƒ¨åˆ†ï¼Œå› ä¸ºå½“å‰è·¯å¾„å·²ç»æ˜¯ /notes/[category]
    type: 'file'
  };
});
---

<BaseLayout title={category}>
  <article>
    <Breadcrumb items={[
      { label: 'ç¬”è®°', href: '/notes' },
      { label: category!, href: `/notes/${category}` }
    ]} />

    <h1>{category}</h1>

    <div class="items-grid">
      {files.length === 0 ? (
        <p class="empty-state">è¿™ä¸ªåˆ†ç±»ä¸‹è¿˜æ²¡æœ‰æ–‡ä»¶</p>
      ) : (
        files.map(file => (
          <ItemLink
            href={`/notes/${category}${file.path}`}
            icon="ğŸ“„"
            title={file.name}
          />
        ))
      )}
    </div>
  </article>

  <style>
    h1 {
      font-size: 2rem;
      margin-bottom: 2rem;
    }

    .items-grid {
      display: grid;
      gap: 0.8rem;
    }

    .empty-state {
      color: var(--color-text-muted);
      text-align: center;
      padding: 2rem;
    }
  </style>
</BaseLayout>

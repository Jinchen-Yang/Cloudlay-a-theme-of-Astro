---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import ItemLink from '../components/ItemLink.astro';

// 1. è·å–æ‰€æœ‰ç¬”è®°
const allNotes = await getCollection('notes');

// 2. æå–æ‰€æœ‰å”¯ä¸€çš„åˆ†ç±»å
// å‡è®¾ slug ç»“æ„æ˜¯ "Category/NoteName"
const categories = [...new Set(allNotes.map(note => note.slug.split('/')[0]))].sort();

// 3. æ„é€ æ˜¾ç¤ºæ•°æ®
const items = categories.map(cat => ({
  name: cat,
  path: `/${cat}`,
  type: 'folder'
}));
---

<BaseLayout title="å­¦ä¹ ç¬”è®°">
  <article>
    <h1>å­¦ä¹ ç¬”è®°</h1>
    <p class="subtitle">æ•´ç†çš„å­¦ä¹ ç¬”è®°å’ŒçŸ¥è¯†ç‚¹æ±‡æ€»</p>

    <div class="notes-grid">
      {items.length === 0 ? (
        <p class="empty-state">æš‚æ—¶è¿˜æ²¡æœ‰ç¬”è®°</p>
      ) : (
        items.map(item => (
          <ItemLink
            href={`/notes${item.path}`}
            icon={item.type === 'folder' ? 'ğŸ“' : 'ğŸ“„'}
            title={item.name}
          />
        ))
      )}
    </div>
  </article>

  <style>
    h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      color: var(--color-text-secondary);
      margin-bottom: 2rem;
    }

    .notes-grid {
      display: grid;
      gap: 1rem;
    }

    .empty-state {
      color: var(--color-text-muted);
      text-align: center;
      padding: 2rem;
    }
  </style>
</BaseLayout>
